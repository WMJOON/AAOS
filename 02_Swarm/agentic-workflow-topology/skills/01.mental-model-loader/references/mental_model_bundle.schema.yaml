$schema: "https://json-schema.org/draft/2020-12/schema"
title: mental_model_bundle
type: object
required:
  - domain
  - bundle_ref
  - core_axioms
  - local_charts
  - module_index
  - node_chart_map
  - execution_checkpoints
  - loading_policy
  - output_contract
properties:
  domain:
    type: string
  bundle_ref:
    type: object
    required: [id, version, generated_at]
    properties:
      id: { type: string }
      version: { type: string }
      generated_at: { type: string }
  core_axioms:
    type: array
    items: { type: string }
  local_charts:
    type: array
    items:
      type: object
      required: [id, purpose, selection_rule]
      properties:
        id: { type: string }
        purpose: { type: string }
        selection_rule: { type: string }
  module_index:
    type: array
    items:
      type: object
      required: [module_id, question_axis]
      properties:
        module_id: { type: string }
        question_axis: { type: string }
  node_chart_map:
    type: array
    items:
      type: object
      required: [node_id, chart_ids, checkpoint_id]
      properties:
        node_id: { type: string }
        chart_ids:
          type: array
          minItems: 1
          items: { type: string }
        checkpoint_id: { type: string }
  execution_checkpoints:
    type: array
    minItems: 1
    items:
      type: object
      required: [checkpoint_id, stage, required_inputs, required_artifacts]
      properties:
        checkpoint_id: { type: string }
        stage:
          type: string
          enum: [preflight, pre_h1, pre_h2]
        required_inputs:
          type: array
          items: { type: string }
        required_artifacts:
          type: array
          items: { type: string }
  loading_policy:
    type: object
  output_contract:
    type: object
